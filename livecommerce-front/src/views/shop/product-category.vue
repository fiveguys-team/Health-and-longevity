<template>
  <div>
    <NavbarOne />

    <!-- 배경 이미지 + 타이틀 -->
    <div
        class="flex items-center gap-4 flex-wrap bg-overlay py-16 sm:py-20 before:bg-title before:bg-opacity-70"
        :style="{ backgroundImage: 'url(' + bg + ')' }"
    >
      <div class="text-center w-full">
        <h2 class="text-white text-4xl md:text-5xl font-semibold leading-none">
          {{ decodeURIComponent(categoryTitle) }}
        </h2>
        <ul class="flex justify-center gap-2 text-base md:text-lg text-white mt-4">
          <li><router-link to="/">고민별</router-link></li>
          <li>/</li>
          <li class="text-primary">{{ decodeURIComponent(categoryTitle) }}</li>
        </ul>
      </div>
    </div>

    <!-- 상품 리스트 -->
    <div class="pt-20 pb-24 bg-white">
      <div class="container-fluid">
        <div class="max-w-[1720px] mx-auto" data-aos="fade-up" data-aos-delay="200">
          <LayoutOne
              v-if="productList.length > 0"
              :classList="'grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 sm:gap-8'"
              :productList="productList"
          />

          <div v-else class="text-center text-gray-400 text-lg mt-20">
            해당 카테고리의 승인된 상품이 없습니다 😥
          </div>

          <!-- 페이징 (더미 UI) -->
          <div class="mt-14 flex items-center justify-center gap-2">
            <button class="w-10 h-10 flex items-center justify-center border rounded text-gray-500 hover:text-black">&lt;</button>
            <button
                v-for="n in 10"
                :key="n"
                class="w-10 h-10 flex items-center justify-center border rounded text-gray-700 hover:bg-gray-200"
            >
              {{ String(n).padStart(2, '0') }}
            </button>
            <button class="w-10 h-10 flex items-center justify-center border rounded text-gray-500 hover:text-black">&gt;</button>
          </div>
        </div>
      </div>
    </div>

    <FooterOne />
    <ScrollToTop />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, watch } from 'vue'
import { useRoute } from 'vue-router'
import axios from '@/utils/axios'
import Aos from 'aos'

import NavbarOne from '@/components/navbar/navbar-one.vue'
import LayoutOne from '@/components/product/layout-one.vue'
import FooterOne from '@/components/footer/footer-one.vue'
import ScrollToTop from '@/components/scroll-to-top.vue'

import bg from '@/assets/img/shortcode/breadcumb.jpg'

const route = useRoute()
const categoryTitle = computed(() => route.params.category || '전체')
const productList = ref([])

const categoryMap = {
  'blood-pressure': '혈압',
  'eye': '눈',
  'eye-health': '눈',
  'joint': '뼈/관절/연결성분',
  'joint-health': '뼈/관절/연결성분',
  'digestion': '장건강',
  'gut-health': '장건강',
  'memory': '기억력',
  'immune': '면역력',
  'fatigue': '피로개선',
  'supplement': '영양보충'
}

onMounted(() => {
  Aos.init()
  fetchProductList()
})

watch(() => route.params.category, fetchProductList)

async function fetchProductList() {
  try {
    const category = route.params.category
    const korCategory = categoryMap[category]

    if (!korCategory) {
      productList.value = []
      return
    }

    const res = await axios.get('/products', {
      params: {
        status: 'APPROVED',
        category: korCategory
      }
    })

    productList.value = res.data.map(product => ({
      ...product,
      reviewCount: product.reviewCount || 0,
      averageRating: product.averageRating || '0.0'
    }))
  } catch (err) {
    console.error('❌ 상품 목록 불러오기 실패', err)
  }
}
</script>
