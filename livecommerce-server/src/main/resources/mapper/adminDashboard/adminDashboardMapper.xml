<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.livecommerce_server.adminDashboard.mapper.AdminDashboardMapper">

<!--	이번달 누적 주문수-->
	<select id="selectMonthOrders" resultType="Integer">
		SELECT count(order_id) FROM ORDERS_M
		WHERE left(order_date, 8)
		BETWEEN CONCAT(DATE_FORMAT(CURRENT_DATE, '%Y%m'), '01')
		AND DATE_FORMAT(CURRENT_DATE, '%Y%m%d')
	</select>

<!--	저반달 누적 주문수 ( m-1 / 1 ~ m-1 / d 일)-->
	<select id="selectPreviousMonthOrders" resultType="Integer">
		SELECT count(order_id) FROM ORDERS_M
		WHERE LEFT(order_date, 8)
			BETWEEN CONCAT(DATE_FORMAT(DATE_SUB(CURRENT_DATE, INTERVAL 1 MONTH), '%Y%m'), '01')
		  AND DATE_FORMAT(DATE_SUB(CURRENT_DATE, INTERVAL 1 MONTH), '%Y%m%d')
	</select>

<!--	입점업체 수 -->
	<select id="selectVendorCount" resultType="Integer">
		SELECT count(distinct vendor_id) FROM VENDOR_m
	</select>

<!--	금년 누적 매출-->
<!--	추후 페이먼트 상태 코드 변경 필요 -->
	<select id="selectTotalRevenue" resultType="Integer">
		SELECT COALESCE(sum(discount_amount), 0) + COALESCE(sum(total_amount), 0) as totalRevenue
		FROM orders_m o, payment_d p
		WHERE o.payments_id = p.payments_id AND p.payment_status_code = '04'
		AND left(o.order_date, 8) BETWEEN DATE_FORMAT(CURRENT_DATE, '%Y0101') AND DATE_FORMAT(CURRENT_DATE, '%Y%m%d')
	</select>

<!--	작년 누적 매출-->
	<select id="selectPreviousRevenue" resultType="Integer">
		SELECT COALESCE(SUM(o.discount_amount), 0) + COALESCE(SUM(o.total_amount), 0) AS totalRevenue
		FROM orders_m o, payment_d p
		WHERE o.payments_id = p.payments_id AND p.payment_status_code = '04'
		AND LEFT(o.order_date, 8) BETWEEN CONCAT(DATE_FORMAT(DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR),'%Y'),'0101')
		AND DATE_FORMAT(DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR),'%Y%m%d');
	</select>



</mapper>